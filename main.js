(()=>{"use strict";class e{constructor({data:e,handleCardClick:t,handleLikeClick:s,handleDeleteIconClick:n},i){this._cardInfo=e,this._name=this._cardInfo.name,this._link=this._cardInfo.link,this._cardsTemplate=i,this._cardId=this._cardInfo._id,this._handleDeleteIconClick=n,this.handleCardClick=t,this._handleLikeClick=s,this._ownerCardId=this._cardInfo.owner._id,this._userId="3211a95e6aa00f2dd8d64029"}_getTemplate(){return document.querySelector(this._cardsTemplate).content.querySelector(".element").cloneNode(!0)}deleteCard(){this._element.remove()}checkLike(){return this._likeButton.classList.contains("element__like_active")}likeCard(){this._likeButton.classList.add("element__like_active")}unLikeCard(){this._likeButton.classList.remove("element__like_active")}updateLikeCount(e){this._likeCount.textContent=e}getCardElement(){return this._element=this._getTemplate(),this._likeButton=this._element.querySelector(".element__like"),this._deleteButton=this._element.querySelector(".element__trash"),this._photoElement=this._element.querySelector(".element__photo"),this._likeCount=this._element.querySelector(".element__like-counter"),this._likesList=this._cardInfo.likes,this._element.querySelector(".element__title").textContent=this._name,this._photoElement.src=this._link,this._photoElement.alt=this._name,this._ownerCardId!==this._userId&&this._deleteButton.remove(),this.updateLikeCount(this._cardInfo.likes.length),this._likesList.some((e=>e._id===this._userId))&&this.likeCard(),this._setEventListeners(),this._element}_setEventListeners(){this._likeButton.addEventListener("click",(()=>this._handleLikeClick(this.checkLike(),this._cardId))),this._deleteButton.addEventListener("click",(()=>this._handleDeleteIconClick(this))),this._photoElement.addEventListener("click",(()=>this.handleCardClick(this._name,this._link)))}}class t{constructor(e,t){this._settings=e,this._element=t,this._buttonElement=document.querySelector(this._settings.submitButtonSelector),this._inputList=Array.from(document.querySelectorAll(".popup__input"))}_showError(){document.querySelector(`#${this._element.id}-error`).textContent=this._element.validationMessage,this._element.classList.add(this._settings.inputErrorClass)}_hideError(){document.querySelector(`#${this._element.id}-error`).textContent="",this._element.classList.remove(this._settings.inputErrorClass)}_checkInputValidity(){this._element.checkValidity()?this._hideError():this._showError()}_toggleButtonState(){this._element.checkValidity()?(this._buttonElement.classList.remove(this._settings.inactiveButtonClass),this._buttonElement.disabled=!1):(this._buttonElement.classList.add(this._settings.inactiveButtonClass),this._buttonElement.disabled=!0)}_setEventListeners(){this._element.addEventListener("input",(()=>{this._checkInputValidity(),this._toggleButtonState()})),this._toggleButtonState()}enableValidation(){this._element.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}class s{constructor(e){this._popup=document.querySelector(e),this._closeButton=this._popup.querySelector(".popup__close"),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleOverlayClose(e){e.target===e.currentTarget&&this.close()}setEventListeners(){this._closeButton.addEventListener("click",(e=>this.close(e))),this._popup.addEventListener("click",(e=>this._handleOverlayClose(e)))}}class n extends s{constructor(e,t){super(e),this._submitFormHandler=t,this._popupForm=this._popup.querySelector(".popup__form")}_getInputValues(){return Array.from(this._popupForm.querySelectorAll(".popup__input")).map((e=>e.value))}setEventListeners(){this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._submitFormHandler(...this._getInputValues())})),super.setEventListeners()}_close(){super.close()}}const i=document.querySelector(".profile__edit-button"),r=document.querySelector(".profile__add-button"),o=document.querySelector(".profile__edit-avatar"),a=document.querySelector(".popup__button_confirmation"),l=document.querySelector(".popup__form-information_name"),h=document.querySelector(".popup__form-information_aboutme"),c=document.querySelector(".elements"),_=document.querySelector(".popup__button_avatar"),u=document.querySelector(".popup__button_profile"),d=document.querySelector(".popup__button_place"),p=new n(".popup_profile",(function(e,t,s){y(u,"Сохранение..."),E.editUserInfo(e,t,s).then((e=>{const t={name:e.name,userMainInfo:e.about,avatar:e.avatar};C.setUserInfo(t),p.close()})).catch((e=>console.log(e))).finally((()=>y(u,"Сохранить")))}));p.setEventListeners();const m=new n(".popup_place",(function(e,t){y(d,"Сохранение..."),E.addCard(e,t).then((e=>{L.addItem(g(e)),m.close()})).catch((e=>console.log(e))).finally((()=>y(d,"Сохранить")))}));m.setEventListeners();const f=new n(".popup_avatar",(function(e){y(_,"Сохранение..."),E.editUserAvatar(e).then((e=>{const t={name:e.name,userMainInfo:e.about,avatar:e.avatar};C.setUserInfo(t),f.close()})).catch((e=>console.log(e))).finally((()=>y(_,"Сохранить")))}));f.setEventListeners();const k=new class extends s{constructor(e){super(e),this._image=this._popup.querySelector(".popup__image"),this._imageTitle=this._popup.querySelector(".popup__title_image")}open(e,t){this._image.src=t,this._image.alt=e,this._imageTitle.textContent=e,super.open()}}(".popup_fullimage");k.setEventListeners();const v=new class extends s{constructor(e,t){super(e),this._submitHandler=t,this._popupForm=this._popup.querySelector(".popup__form")}open(e){this._element=e,super.open()}setEventListeners(){this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._submitHandler(this._element)})),super.setEventListeners()}}(".popup_confirmation",(function(e){y(a,"Удаление..."),E.deleteCard(e._cardId,e._ownerCardId).then((()=>{e.deleteCard(),v.close()})).catch((e=>console.log(e))).finally((()=>{y(a,"Да")}))}));v.setEventListeners();const C=new class{constructor(e,t,s){this._userName=document.querySelector(e),this._userMainInfo=document.querySelector(t),this._avatar=document.querySelector(s)}getUserInfo(){return{name:this._userName.textContent,info:this._userMainInfo.textContent,avatar:this._avatar.src}}setUserInfo(e){this._userName.textContent=e.name,this._userMainInfo.textContent=e.userMainInfo,this._avatar.src=e.avatar}}(".profile__name",".profile__aboutme",".profile__avatar"),E=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_getResponseData(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}getCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then((e=>this._getResponseData(e)))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then((e=>this._getResponseData(e)))}addCard(e,t){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((e=>this._getResponseData(e)))}editUserInfo(e,t){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((e=>this._getResponseData(e)))}editUserAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>this._getResponseData(e)))}likeCard(e){return fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"PUT",headers:this._headers}).then((e=>this._getResponseData(e)))}unlikeCard(e){return fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:this._headers}).then((e=>this._getResponseData(e)))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>this._getResponseData(e)))}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-18",headers:{authorization:"9d674f7b-2a9e-4e8a-af7b-88d210976df9","Content-Type":"application/json"}});Promise.all([E.getUserInfo(),E.getCards()]).then((e=>{const[t,s]=e,n={name:t.name,userMainInfo:t.about,avatar:t.avatar};return C.setUserInfo(n),L.renderItems(s),e})).catch((e=>console.log(e)));const y=(e,t)=>{e.textContent=t};function g(t){const s=new e({data:t,handleCardClick:(e,t)=>{k.open(e,t)},handleLikeClick:(e,t)=>{e?E.unlikeCard(t).then((e=>{s.updateLikeCount(e.likes.length),s.unLikeCard()})).catch((e=>console.log(e))):E.likeCard(t).then((e=>{s.updateLikeCount(e.likes.length),s.likeCard()})).catch((e=>console.log(e)))},handleDeleteIconClick:e=>{v.open(e)}},"#cards-container");return s.getCardElement()}const L=new class{constructor(e,t){this._renderer=e,this._container=t}renderItems(e){e.forEach((e=>{this.addItem(this._renderer(e))}))}addItem(e){this._container.prepend(e)}}(g,c);i.addEventListener("click",(()=>p.open())),r.addEventListener("click",(()=>m.open())),o.addEventListener("click",(()=>f.open())),i.addEventListener("click",(()=>{p.open();const e=C.getUserInfo();l.value=e.name,h.value=e.info})),Array.from(document.querySelectorAll(".popup__form")).forEach((e=>{const s=e.querySelector(".popup__button").classList[1];Array.from(e.querySelectorAll(".popup__input")).forEach((e=>{new t({submitButtonSelector:"."+s,inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input-invalid"},e).enableValidation()}))}))})();